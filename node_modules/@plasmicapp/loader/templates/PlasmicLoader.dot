
/** This file is auto-generated by Plasmic; please do not edit! */
import * as React from 'react';

{{~ it.componentData :data}}
import {{=data.name}}{{=data.projectId}} from "{{=data.path}}";
{{~}}

{{~ it.providerData :data}}
{{? data.providerName }}
import { {{=data.providerName}} as {{=data.name}}{{=data.projectId}} } from "{{=data.path}}";
{{??}}
import {{=data.name}}{{=data.projectId}} from "{{=data.path}}";
{{?}}
{{~}}

const componentsWithOneProject = {
  {{~ it.componentsWithOneProject :data}}
  "{{=data.name}}": {{=data.name}}{{=data.projectId}},
  {{~}}
};

const providersWithOneProject = {
  {{~ it.providersWithOneProject :data}}
  "{{=data.name}}": {
    "component": {{=data.name}}{{=data.projectId}},
    "isContext": !Boolean( "{{=data.providerName}}" ),
  },
  {{~}}
};

const componentMap = {
  {{~ it.componentMap :component}}
  "{{=component.name}}": {
    {{~ component.projects :project}}
    "{{=project.projectId}}": {{=component.name}}{{=project.projectId}}
    {{~}}
  },
  {{~}}
};

const providerMap = {
  {{~ it.providerMap :provider}}
  "{{=provider.name}}": {
    {{~ provider.projects :project}}
    "{{=project.projectId}}": {
      "component": {{=provider.name}}{{=project.projectId}},
      "isContext": !Boolean({{=provider.providerName}}),
    },
    {{~}}
  },
  {{~}}
};

function getComponent(projectId, component) {
  if (componentsWithOneProject[component]) {
    return componentsWithOneProject[component];
  }
  if (!componentMap[component]) {
    throw new Error(`The component ${component} could not be found.`);
  }
  if (!componentMap[component][projectId]) {
    throw new Error(`The component ${component} requires a valid projectId. Passed: ${projectId}. Options: ${Object.keys(componentMap[component])}`);
  }
  return componentMap[component][projectId];
};

function renderWithProviders(component, projectId, providersWithProps) {
  const providers = Object.entries(providersWithProps || {}).map(([provider, value]) => {
    if (providersWithOneProject[provider]) {
      const {component, isContext} = providersWithOneProject[provider];
      return [isContext ? component.Provider :component, value];
    }
    if (!providerMap[provider]) {
      throw new Error(`The provider ${provider} could not be found.`);
    }
    if (!providerMap[provider][projectId]) {
      throw new Error(`The provider ${provider} requires a valid projectId. Passed: ${projectId}. Options: ${Object.keys(providerMap[provider])}`);
    }
    const {component, isContext} = providerMap[provider][projectId];
    return [isContext ? component.Provider : component, value];
  });

  if (!providers.length) {
    return component;
  }

  return providers.reduce((child, [wrapper, value]) => React.createElement(wrapper, {value}, child), component);
};

export function Providers({projectId, props = {}, children}) {
  return renderWithProviders(children, projectId, props);
}

export default function PlasmicLoader({ projectId, component, componentProps = {}, providerProps = {} }) {
  const Component = getComponent(projectId, component);
  return renderWithProviders(React.createElement(Component, componentProps), projectId, providerProps);
};
